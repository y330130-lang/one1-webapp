<!doctype html><html lang="ko"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>매도</title><link rel="stylesheet" href="/assets/style.css"/></head><body><main class="container"><a href="/ui_home.html">← 홈</a><h1>매도</h1><div class="card"><div class="grid grid-2"><label>마켓<select id="market" class="input"><option value="USDT_KRW">USDT_KRW</option><option value="BTC_KRW">BTC_KRW</option><option value="ETH_KRW">ETH_KRW</option></select></label><label>주문유형<select id="ordType" class="input"><option value="limit">지정가</option></select></label><label>가격(KRW)<input id="price" class="input" type="number" inputmode="decimal" placeholder="예: 1390"/></label><label>수량(qty)<input id="qty" class="input" type="number" inputmode="decimal" placeholder="예: 100"/></label></div><div class="card"><div style="display:flex;justify-content:space-between;align-items:center"><div>현재가: <strong id="nowPrice">-</strong> KRW</div><button id="refreshPrice" class="btn gray">시세 새로고침</button></div><div style="margin-top:8px">현재 잔고: <strong id="balanceKRW">-</strong> KRW</div><div class="grid" style="grid-template-columns:repeat(4,1fr);margin-top:10px"><button class="btn gray" data-pct="25">25%</button><button class="btn gray" data-pct="50">50%</button><button class="btn gray" data-pct="75">75%</button><button class="btn gray" data-pct="100">100%</button></div><span class="badge">잔고 기준 비율로 수량 자동 계산</span></div><button id="sellBtn" class="btn">매도</button></div><div class="card"><pre id="out">{결과 대기}</pre></div></main><script type="module">import{$,authHeaders}from"/js/app.js";const nf=new Intl.NumberFormat("ko-KR"),$price=$("#price"),$qty=$("#qty"),$bal=$("#balanceKRW"),$out=$("#out");async function fetchPrice(){const e=$("#market").value,t=await fetch(`/api/price?market=${encodeURIComponent(e)}`),n=await t.json();if(n?.ok&&n.price)return $("#nowPrice").textContent=nf.format(n.price),$price.value||($price.value=String(n.price)),n.price;return $out.textContent=JSON.stringify(n,null,2),null}async function fetchKRW(){try{const e=await fetch("/api/balance",{method:"POST",headers:authHeaders(),body:"{}"}),t=await e.json(),n=t?.coinone||{},a=Number(n.krw?.avail||n.krw?.balance||n.balance?.krw||n.availableKrw||n.total_krw||0);return $bal.textContent=nf.format(a),a}catch(e){return $out.textContent=String(e),0}}function applyPct(e,t,n){if(!n||!t)return;const a=t*(e/100)/n;$qty.value=(Math.floor(1e6*a)/1e6).toString()}document.addEventListener("DOMContentLoaded",async()=>{await fetchPrice(),await fetchKRW(),$("#refreshPrice").onclick=fetchPrice,$("#market").onchange=fetchPrice,document.querySelectorAll("[data-pct]").forEach(e=>{e.onclick=()=>{const e=Number($price.value||0),t=Number(String($bal.textContent).replace(/[^\d]/g,""))||0;applyPct(Number(e.target?.dataset?.pct||e.dataset.pct),t,e)}}),$("#sellBtn").onclick=async()=>{const e={market:$("#market").value,price:Number($price.value||0),qty:Number($qty.value||0),ord_type:$("#ordType").value};try{const t=await fetch("/api/place-order",{method:"POST",headers:authHeaders(),body:JSON.stringify(e)});$out.textContent=JSON.stringify(await t.json(),null,2)}catch(e){$out.textContent=String(e)}}});</script></body></html>